{%- style -%}
  #ks-media-slider-{{ section.id }} {
    padding-top: {{ section.settings.pt | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.pb | times: 0.75 | round: 0 }}px;
  }

  #ks-media-slider-{{ section.id }} .card {
    --border-radius: {{ section.settings.card_corner_radius | divided_by: 10.0 }}rem;
    --border-width: {{ section.settings.card_border_thickness | divided_by: 10.0 }}rem;
    --border-opacity: {{ section.settings.card_border_opacity | divided_by: 100.0 }};
    --text-alignment: {{ section.settings.card_text_alignment }};
  }

  @media screen and (min-width: 750px) {
    #ks-media-slider-{{ section.id }} {
      padding-top: {{ section.settings.pt }}px;
      padding-bottom: {{ section.settings.pb }}px;
    }
  }
{%- endstyle -%}

<div 
  id="ks-media-slider-{{ section.id }}"
  class="ks-media-slider color-{{ section.settings.color_scheme }} gradient">
  <div 
    class="page-width"
    style="max-width: {{ section.settings.page_width | append: 'px' }}">
    <slider-component 
      class="
        slider-mobile-gutter slider-component-desktop ks-slider-component-full
        {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}
      ">
      <ul
        id="Slider-{{ section.id }}"
        data-id="{{ section.id }}"
        class="grid grid--1-col slider slider--tablet slider--desktop"
        role="list"
        aria-label="{{ 'general.slider.name' | t }}">
        {%- for block in section.blocks -%}
          {% liquid 
            if block.settings.show_only_media
              assign media_width = 1600
            else
              assign media_width = 800
            endif
            assign video_img_width = media_width | append: 'x'
          %}
          <li
            id="Slide-{{ section.id }}-{{ forloop.index }}"
            class="grid__item slider__slide {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
            {% if settings.animations_reveal_on_scroll %}
              data-cascade
              style="--animation-order: {{ forloop.index }};"
            {% endif %}
          >
            <div class="ks-media-slider-content {% if block.settings.media_alignment == 'right' %}ks-media-slider-content-desktop-reversed{% endif %}">
              <div class="{% if block.settings.show_only_media %}ks-media-slider-content-only-media{% else %}ks-media-slider-content-left{% endif %}">
                {% if block.settings.external_video != blank %}
                  {% liquid 
                    if block.settings.external_video.type == 'youtube'
                      assign video_src = 'https://www.youtube.com/embed/' | append: block.settings.external_video.id
                    else
                      assign video_src = 'https://player.vimeo.com/video/' | append: block.settings.external_video.id
                    endif
                  %}
                  <iframe
                    class="ks-media-slider-media"
                    src="{{ video_src }}"
                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" 
                    frameborder="0"
                    allowfullscreen
                    loading="lazy"
                    style="aspect-ratio: 16/9; width: 100% !important; display: flex;">
                  </iframe>
                {% elsif block.settings.video != blank %}
                  {{- 
                    block.settings.video | video_tag: 
                      class: 'ks-media-slider-media',
                      image_size: video_img_width, 
                      autoplay: false, 
                      loop: block.settings.video_loop, 
                      muted: block.settings.video_muted, 
                      controls: block.settings.video_controls,
                      loading: 'lazy',
                      preload: 'none',
                      style: 'width: 100%; height: auto; display: flex;',
                      data-autoplay: block.settings.video_autoplay
                  -}}
                {% elsif block.settings.img != blank %}
                  <img
                    src="{{ block.settings.img | image_url: width: media_width }}"
                    alt="{{ block.settings.img.alt }}"
                    class="ks-media-slider-media"
                    width="{{ media_width }}"
                    height="{{ media_width | divided_by: block.settings.img.aspect_ratio | round }}"
                    loading="lazy"
                    style="
                      width: 100%; object-fit: cover; display: flex; height: auto;
                      {% if block.settings.img_height_mobile > 0 %}
                        --img-height-mobile: {{ block.settings.img_height_mobile | append: 'px' }};
                      {% endif %}
                      {% if block.settings.img_height_desktop > 0 %}
                        --img-height-desktop: {{ block.settings.img_height_desktop | append: 'px' }};
                      {% endif %}
                    ">
                {% else %}
                  {{ 'image' | placeholder_svg_tag: 'svg-placeholder' }}
                {% endif %}
              </div>
              {% unless block.settings.show_only_media %}
                <div 
                  class="
                    ks-media-slider-content-right
                    {{ block.settings.text_align_mobile }}
                    {{ block.settings.text_align_desktop }}
                  ">
                  {% render 'ks-section-content-block', block: block %}
                </div>
              {% endunless %}
            </div>
          </li>
        {%- endfor -%}
      </ul>
      <div class="slider-buttons">
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'general.slider.previous_slide' | t }}"
          aria-controls="Slider-{{ section.id }}">
          <span class="svg-wrapper">
            {{- 'icon-caret.svg' | inline_asset_content -}}
          </span>
        </button>
        <div class="slider-counter caption">
          <span class="slider-counter--current">1</span>
          <span aria-hidden="true"> / </span>
          <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
          <span class="slider-counter--total">{{ section.blocks.size }}</span>
          <span class="slider-counter--total-fixed">{{ section.blocks.size }}</span>
        </div>
        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'general.slider.next_slide' | t }}"
          aria-controls="Slider-{{ section.id }}">
          <span class="svg-wrapper">
            {{- 'icon-caret.svg' | inline_asset_content -}}
          </span>
        </button>
      </div>
    </slider-component>
  </div>
</div>

{% schema %}
{
  "name": "KS - Media Slider",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "page_width",
      "label": "Page width (px)",
      "info": "Leave empty to use the global \"page-width\"."
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "pt",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 36,
      "unit": "px",
    },
    {
      "type": "range",
      "id": "pb",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 36,
      "unit": "px",
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "header",
          "content": "General"
        },
        {
          "type": "checkbox",
          "id": "show_only_media",
          "label": "Show only media",
          "info": "If this setting is enabled, the text will hide and the media will be shown in full-width",
          "default": false,
        },
        {
          "type": "select",
          "id": "media_alignment",
          "label": "Media aligmnment - desktop",
          "default": "left",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "right", "label": "Right" }
          ]
        },
        {
          "type": "header",
          "content": "Image"
        },
        {
          "type": "image_picker",
          "id": "img",
          "label": "Image"
        },
        {
          "type": "range",
          "id": "img_height_mobile",
          "label": "Image height - mobile",
          "info": "Select \"0\" to adapt",
          "min": 0,
          "max": 1000,
          "default": 0,
          "step": 50,
          "unit": "px",
        },
        {
          "type": "range",
          "id": "img_height_desktop",
          "label": "Image height - desktop",
          "info": "Select \"0\" to adapt",
          "min": 0,
          "max": 1000,
          "default": 0,
          "step": 50,
          "unit": "px",
        },
        {
          "type": "header",
          "content": "Video (MP4)"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        },
        {
          "type": "checkbox",
          "id": "video_autoplay",
          "label": "Autoplay",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "video_loop",
          "label": "Loop",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "video_muted",
          "label": "Muted",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "video_controls",
          "label": "Controls",
          "default": true
        },
        {
          "type": "header",
          "content": "External Video"
        },
        {
          "type": "video_url",
          "id": "external_video",
          "label": "Video",
          "accept": [
            "youtube", "vimeo"
          ]
        },
        {
          "type": "header",
          "content": "Text"
        },
        {
          "type": "select",
          "id": "text_align_mobile",
          "label": "Text align - mobile",
          "options": [
            { "value": "text-start", "label": "Left" },
            { "value": "text-center", "label": "Center" },
            { "value": "text-end", "label": "Right" },
          ],
          "default": "text-center"
        },
        {
          "type": "select",
          "id": "text_align_desktop",
          "label": "Text align - desktop",
          "options": [
            { "value": "text-tablet-start", "label": "Left" },
            { "value": "text-tablet-center", "label": "Center" },
            { "value": "text-tablet-end", "label": "Right" },
          ],
          "default": "text-tablet-start"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "Optional Subtitle",
          "info": "Leave empty to disable"
        },
        {
          "type": "select",
          "id": "subtitle_font_size",
          "label": "Subtitle font-size",
          "default": "fs-sm",
          "options": [
            { "value": "fs-xs", "label": "xs" },
            { "value": "fs-sm", "label": "sm" },
            { "value": "fs-md", "label": "md" },
            { "value": "fs-lg", "label": "lg" },
            { "value": "fs-xl", "label": "xl" }
          ]
        },
        {
          "type": "inline_richtext",
          "id": "title",
          "label": "Title",
          "default": "Welcome to our store",
          "info": "Leave empty to disable"
        },
        {
          "type": "select",
          "id": "title_font_size",
          "label": "Title font-size",
          "default": "h1",
          "options": [
            { "value": "h2", "label": "Small" },
            { "value": "h1", "label": "Medium" },
            { "value": "h0", "label": "Large" },
            { "value": "hxl", "label": "Extra large" },
            { "value": "hxxl", "label": "Extra extra large" }
          ]
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>An optional description for this slide</p>",
          "info": "Leave empty to disable"
        },
        {
          "type": "select",
          "id": "description_font_size",
          "label": "Description font-size",
          "default": "fs-lg",
          "options": [
            { "value": "fs-xs", "label": "xs" },
            { "value": "fs-sm", "label": "sm" },
            { "value": "fs-md", "label": "md" },
            { "value": "fs-lg", "label": "lg" },
            { "value": "fs-xl", "label": "xl" }
          ]
        },
        {
          "type": "header",
          "content": "Primary button"
        },
        {
          "type": "text",
          "id": "btn_primary_text",
          "label": "Button text",
          "default": "Primary button",
          "info": "Leave empty to disable"
        },
        {
          "type": "select",
          "id": "btn_primary_style",
          "label": "Button style",
          "default": "button--primary",
          "options": [
            { "value": "button--primary", "label": "Primary" },
            { "value": "button--secondary", "label": "Secondary" }
          ]
        },
        {
          "type": "url",
          "id": "btn_primary_url",
          "label": "Button URL"
        },
        {
          "type": "header",
          "content": "Secondary button"
        },
        {
          "type": "text",
          "id": "btn_secondary_text",
          "label": "Button text",
          "default": "Secondary button",
          "info": "Leave empty to disable"
        },
        {
          "type": "select",
          "id": "btn_secondary_style",
          "label": "Button style",
          "default": "button--secondary",
          "options": [
            { "value": "button--primary", "label": "Primary" },
            { "value": "button--secondary", "label": "Secondary" }
          ]
        },
        {
          "type": "url",
          "id": "btn_secondary_url",
          "label": "Button URL"
        },
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "presets": [
    {
      "name": "KS - Media Slider",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}