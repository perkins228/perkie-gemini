{% comment %}
  Order Custom Images Display
  Shows customer-uploaded images for staff order management
  
  Usage:
  {% render 'order-custom-images', order: order %}
{% endcomment %}

<style>
  .custom-images-section {
    margin: 2rem 0;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #dee2e6;
  }
  
  .custom-images-header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    font-weight: 600;
    color: #495057;
  }
  
  .custom-images-header svg {
    width: 20px;
    height: 20px;
    margin-right: 0.5rem;
    color: #6c757d;
  }
  
  .custom-image-item {
    background: white;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .custom-image-grid {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 1rem;
    align-items: start;
  }
  
  .custom-image-preview {
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid #dee2e6;
  }
  
  .custom-image-preview img {
    width: 100%;
    height: auto;
    display: block;
    max-height: 200px;
    object-fit: contain;
    background: white;
  }
  
  .custom-image-details h4 {
    margin: 0 0 0.5rem 0;
    color: #212529;
    font-size: 1.1rem;
  }
  
  .custom-image-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  
  .custom-image-meta span {
    font-size: 0.875rem;
    color: #6c757d;
  }
  
  .custom-image-meta strong {
    color: #495057;
  }
  
  .custom-image-links {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .custom-image-link {
    padding: 0.25rem 0.75rem;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 0.875rem;
    transition: background 0.2s;
  }
  
  .custom-image-link:hover {
    background: #0056b3;
    color: white;
  }
  
  .custom-image-link.secondary {
    background: #6c757d;
  }
  
  .custom-image-link.secondary:hover {
    background: #545b62;
  }
  
  @media (max-width: 768px) {
    .custom-image-grid {
      grid-template-columns: 1fr;
    }
    
    .custom-image-preview {
      max-width: 300px;
      margin: 0 auto;
    }
  }
</style>

{%- assign has_custom_images = false -%}

{%- for line_item in order.line_items -%}
  {%- if line_item.properties['_has_custom_pet'] == 'true' -%}
    {%- assign has_custom_images = true -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- if has_custom_images -%}
  <div class="custom-images-section">
    <div class="custom-images-header">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      Customer Custom Images
    </div>
    
    {%- for line_item in order.line_items -%}
      {%- if line_item.properties['_has_custom_pet'] == 'true' -%}
        <div class="custom-image-item">
          <div class="custom-image-grid">
            <div class="custom-image-preview">
              {%- if line_item.properties['_processed_image_url'] -%}
                <img src="{{ line_item.properties['_processed_image_url'] }}" alt="Processed custom image" loading="lazy">
              {%- elsif line_item.properties['_original_image_url'] -%}
                <img src="{{ line_item.properties['_original_image_url'] }}" alt="Original custom image" loading="lazy">
              {%- endif -%}
            </div>
            
            <div class="custom-image-details">
              <h4>{{ line_item.product.title }}</h4>
              
              <div class="custom-image-meta">
                {%- if line_item.properties['_pet_name'] -%}
                  <span><strong>Pet Name:</strong> {{ line_item.properties['_pet_name'] }}</span>
                {%- endif -%}
                
                {%- if line_item.properties['_effect_applied'] -%}
                  <span><strong>Effect:</strong> {{ line_item.properties['_effect_applied'] | capitalize }}</span>
                {%- endif -%}
                
                {%- if line_item.properties['_artist_notes'] -%}
                  <span style="display: block; margin-top: 0.5rem;">
                    <strong>Artist Notes:</strong> {{ line_item.properties['_artist_notes'] }}
                  </span>
                {%- endif -%}
              </div>
              
              <div class="custom-image-links">
                {%- if line_item.properties['_processed_image_url'] -%}
                  <a href="{{ line_item.properties['_processed_image_url'] }}" target="_blank" class="custom-image-link">
                    View Processed Image
                  </a>
                {%- endif -%}
                
                {%- if line_item.properties['_original_image_url'] -%}
                  <a href="{{ line_item.properties['_original_image_url'] }}" target="_blank" class="custom-image-link secondary">
                    View Original Image
                  </a>
                {%- endif -%}
              </div>
              
              {%- comment -%} Debug info for development {%- endcomment -%}
              {%- if line_item.properties['_crop_coordinates'] or line_item.properties['_image_transformations'] -%}
                <details style="margin-top: 1rem;">
                  <summary style="cursor: pointer; font-size: 0.875rem; color: #6c757d;">Technical Details</summary>
                  <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #6c757d; font-family: monospace;">
                    {%- if line_item.properties['_crop_coordinates'] -%}
                      <p><strong>Crop Data:</strong> {{ line_item.properties['_crop_coordinates'] }}</p>
                    {%- endif -%}
                    {%- if line_item.properties['_image_transformations'] -%}
                      <p><strong>Transformations:</strong> {{ line_item.properties['_image_transformations'] }}</p>
                    {%- endif -%}
                  </div>
                </details>
              {%- endif -%}
            </div>
          </div>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
{%- endif -%} 